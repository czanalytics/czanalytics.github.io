<!DOCTYPE html>
<html lang="en">

<head>
  <title>Price</title>
    <meta charset="utf-8" />
  <link rel="icon" type="image/x-icon" href="./favicon.png" />
    <link
        rel="stylesheet"
        href="https://pyscript.net/latest/pyscript.css"/>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <link rel="stylesheet" href="./assets/css/examples.css" />
</head>

<body>
<section class="pyscript">
  <div id="folium"></div>
   
<py-config>
  packages = [
  "https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl",
  "folium", "pandas", "numpy", "panel==0.13.1"]
  plugins = ["https://pyscript.net/latest/plugins/python/py_tutor.py"]
</py-config>


<div class="grid grid-rows-4 p-4 bg-blue-100 border-2 justify-items-left">
  
   <div>      
        <select name="flight-mode" id="flight-mode-select">
            <option value="one">EUR</option>
            <option value="gbp">GBP</option>
            <option value="sek">SEK</option>
            <option value="usd">USD</option>
        </select>
    </div>

    <div>
        <h4 class="font-semibold">From</h4>
        <input id="dep" class="w-3/4 bg-white border-4">
    </div>

    <div>
        <h4 class="font-semibold">To</h4>
        <input id="ret" class="w-3/4 bg-white border-4">
    </div>

    <div>
        <button id="book-flight" class="p-2 my-2 bg-green-200 border-2 border-gray-400 rounded-lg">Get Price</button>
        <p id="flight-info" class="italic"> Avg. price with 68% conf. range (low, high) </p>
    </div>
</div>


<py-script>
def approx(x, n=20):
  """Round x to closest n"""

  return round(x/n)*n

def price_est(loc1, loc2, dist = 111, c = 2.0, pro=0.1):
  """Estimate price based on postal code locations."""
  
  p = dist * c             # mockup
  p_lo = p - pro * p
  p_hi = p + pro * p

  return approx(p), approx(p_lo), approx(p_hi)
</py-script>

<py-script>
import js
from js import document

from pyodide.ffi import create_proxy

def _flight_mode_change(*args, **kwargs):
  currentMode = document.getElementById("flight-mode-select").value

  currentMode = 'eur'

  if currentMode == 'one':
    document.getElementById("ret").disabled = True
  else:
    document.getElementById("ret").disabled = False

flight_mode_change = create_proxy(_flight_mode_change)
document.getElementById("flight-mode-select").addEventListener("input", flight_mode_change)

def _book_flight(*args, **kwargs):
  currentMode = document.getElementById("flight-mode-select").value
  currentMode = 'eur'

  loc1 = document.getElementById("dep").value
  loc2 = document.getElementById("ret").value

  price, price_lo, price_hi = price_est(loc1, loc2)
  #price = str(1000); price_lo = 'aaa'; price_hi = 'sssss'

  if currentMode == 'one':
    document.getElementById("flight-info").innerText = f"Departing on {loc1}."
  else:
    document.getElementById("flight-info").innerText = f"{price} EUR ({price_lo}, {price_hi})"


book_flight = create_proxy(_book_flight)
document.getElementById("book-flight").addEventListener("click", book_flight)

flight_mode_change()
</py-script>

<py-script>
import pandas as pd

from pyodide.http import open_url

#url_nuts2 = 'https://raw.githubusercontent.com/czanalytics/multimodal-shipping/main/dat/nuts2.json'
#geo_nuts2= json.loads(open_url(url_nuts2).read())

url = ("https://raw.githubusercontent.com/czanalytics/multimodal-shipping/main/dat/ODMatrix2021_N2.csv")
#url = ("https://raw.githubusercontent.com/Cheukting/pyscript-ice-cream/main/bj-products.csv")
d = pd.read_csv(open_url(url))
d_ = d.loc[(d['Origin'] == 'ES70') & (d['Destination'] == 'PT11') ]
print (d_)
</py-script>

</body>

